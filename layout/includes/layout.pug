-
  let pageTitle = page.title || config.subtitle || ''
  if (is_post()) pageTitle = page.title
  if (is_archive()) pageTitle = 'Archives'
  if (is_tag()) pageTitle = 'Tag: ' + page.tag
  if (is_category()) pageTitle = 'Category: ' + page.category
  if (is_month()) pageTitle += ': ' + page.month + '/' + page.year
  if (is_year()) pageTitle += ': ' + page.year
  if (pageTitle) pageTitle += ' | '
  pageTitle += config.title
  const asideLogo = theme.aside.logo
  const pjax = theme.pjax ? theme.pjax.enable : false
  let onload = 'code.findCode();'
  if (theme.mermaid.enable === true && theme.mermaid.version !== undefined) {
    onload += "mermaid.init(undefined, ('.mermaid'));";
  }
  let searchConfig = null
  if (config.search !== undefined && config.search.enable === true) searchConfig = config.search;
  if (theme.search !== undefined && theme.search.enable === true) searchConfig = theme.search;
  const configs = JSON.stringify({
    hostname: config.url,
    root    : config.root,
    preload : searchConfig.preload !== undefined ? searchConfig.preload : false,
    path    : searchConfig.path !== undefined ? searchConfig.path : '',
    })

doctype html
html(lang=config.language)
  head
    meta(charset='UTF-8')
    meta(name='viewport' content='width=device-width, initial-scale=1.0')
    title= pageTitle
    if theme.valine.enable === true
      script(src='//unpkg.com/valine/dist/Valine.min.js')
    if configs
      script var config = !{configs}
    if theme.gitalk.enable === true
      script(src=config.root + "js/gitalk.js")
    if theme.mermaid.enable === true && theme.mermaid.version !== undefined
      script(src= "//unpkg.com/mermaid@" + theme.mermaid.version + "/dist/mermaid.min.js")
      script
        | mermaid.initialize({
        |   startOnLoad: false
        |   , theme: 'dark'
        | });
    link(rel="stylesheet", href=config.root + "css/arknights.css")
    if theme.stylesheets !== undefined && theme.stylesheets.length > 0
      //- stylesheets list from _config.yml
      each url in theme.stylesheets
        link(rel='stylesheet', href=url)
    style
      |@font-face {
      |  font-family: BenderLight;
      |  src: local('Bender'), url("#{config.root}font/BenderLight.ttf");
      |}
      |@font-face {
      |  font-family: 'JetBrains Mono';
      |  src: local('JetBrains Mono'), url('#{config.root}font/JetBrainsMono-Regular.woff2') format('woff2');
      |}
  body(style={'background-image': `url(${theme.background_image})`})
    if pjax
      .loading(style='opacity: 0')
        .loadingBar.left
        .loadingBar.right
    header
      nav
        .navBtn
          i.navBtnIcon
            span.navBtnIconBar
            span.navBtnIconBar
            span.navBtnIconBar
        ol.navContent
          if searchConfig !== null
            li.navItem.search-header
              input(autocomplete="off" autocorrect="off" autocapitalize="none"
                   placeholder="数据检索" spellcheck="false" maxlength="50"
                   type="text" id="search-input")
          each url, label in theme.menu
            - var match = null
            if url.match(config.archive_dir)
              - match = config.category_dir + ',' + config.tag_dir
            li.navItem(matchdata=match)
              a(href= config.root + url)
                span.navItemTitle= label
      if searchConfig !== null
        .search-popup
          #search-result
    article
      if body
        div!= body
      else
        block content
      if page.published !== undefined
        #bottom-btn
          if tocLength !== null
            a#to-index(href="#toc-div" title="index") ≡
          a#to-top(onClick="index.scrolltop();" title="to top" style="opacity: 0; display: none;") ∧
    aside
      #aside-top
        #about
          a(href=config.root)#logo
            img(src=asideLogo, alt="Logo")
          h1#Dr
            a(href= theme.aside.dr)= config.author
          #description
            for str in config.description
              p= str
        #aside-block
          block aside-block
          if page.published === undefined
            section#total
              a#total-archives(href= config.root + "archives")
                span.total-title Archives Total:
                span.total-number= site.posts.length
              #total-tags
                span.total-title Tags:
                span.total-number= site.tags.length
              #total-categories
                span.total-title Categories:
                span.total-number= site.categories.length
      footer
        if theme.aside.copyright !== null
          each content, title in theme.aside.copyright
            nobr
              span.text-title= title
              span.text-content= content
            br
        nobr="published with "
          a(href='http://hexo.io') Hexo
        wbr
        nobr=" Theme "
          a(href='https://github.com/Yue-plus/hexo-theme-arknights') Arknight
        wbr
        nobr="by "
          a(href='https://github.com/Yue-plus') Yue_plus
    #cursor-container
      #cursor-outer
      #cursor-effect
    if theme.canvas_dust
      canvas#canvas-dust
    if searchConfig !== null
      script(src="/js/search.js")
    script.pjax-js reset=_=>{
      if theme.valine.enable === true
        |  new Valine({
        |    el: '#Valine'
        |    , appId: '#{appID}'
        |    , appKey: '#{appKey}'
        if theme.valine.server_url
          | , serverURLs: '#{theme.valine.server_url}'
        |    , placeholder: '此条评论委托企鹅物流发送'
        |  });
      if theme.gitalk.enable === true
        - let config = theme.gitalk, gitAdmin = ''
        for str in theme.gitalk.admin
          - gitAdmin= gitAdmin + "'" + str + "'"
        |  gitalk = new Gitalk({
        |    clientID: '#{config.client_id}',
        |    clientSecret: '#{config.client_secret}',
        |    repo: '#{config.repo}',
        |    owner: '#{config.owner}',
        |    admin: [#{gitAdmin}],
        |    distractionFreeMode: #{config.distraction_free_mode || false},
        |    id: #{config.id}
        |  });
        |  if (document.querySelector("#comments")) gitalk.render("comments");
      | !{onload}
      |}
    if theme.scripts !== undefined && theme.scripts.length > 0
      //- scripts list from config.yml
      each url in theme.scripts
        script(src=url)
    script(src=config.root + "js/arknights.js")
    if pjax
      script(src="//unpkg.com/pjax@" + theme.pjax.version + "/pjax.js")
    script window.addEventListener("load",()=>{
      if pjax
        | pjax = new Pjax({cacheBust:false,selectors:['title','article','#aside-block','.pjax-js']});
        | new pjaxSupport()
        | document.addEventListener("pjax:complete", reset);
      | reset()})
